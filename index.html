<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Tracker with GPS</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ============ CSS ============ */
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { display:flex; flex-direction:column; height:100vh; overflow:hidden; }
        header { background:#2c3e50; color:white; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
        .logo { display:flex; align-items:center; gap:10px; }
        .logo i { font-size:24px; }
        .header-info { display:flex; gap:20px; font-size:14px; }
        .container { display:flex; flex:1; overflow:hidden; }
        .sidebar { width:350px; background:#f8f9fa; border-right:1px solid #e0e0e0; display:flex; flex-direction:column; overflow:hidden; }
        .sidebar-header { padding:15px; background:#ecf0f1; border-bottom:1px solid #e0e0e0; }
        .search-box { display:flex; margin-bottom:15px; }
        .search-box input { flex:1; padding:10px; border:1px solid #ddd; border-radius:4px 0 0 4px; outline:none; }
        .search-box button { padding:10px; background:#3498db; color:white; border:none; border-radius:0 4px 4px 0; cursor:pointer; }
        .stats { display:flex; justify-content:space-between; background:white; padding:10px; border-radius:4px; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
        .stat-item { text-align:center; }
        .stat-value { font-size:18px; font-weight:bold; color:#2c3e50; }
        .stat-label { font-size:12px; color:#7f8c8d; }
        .bus-list { flex:1; overflow-y:auto; padding:15px; }
        .bus-item { display:flex; align-items:center; padding:12px; background:white; margin-bottom:10px; border-radius:4px; box-shadow:0 1px 3px rgba(0,0,0,0.1); cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .bus-item:hover { transform:translateY(-2px); box-shadow:0 4px 6px rgba(0,0,0,0.1); }
        .bus-icon { width:40px; height:40px; background:#3498db; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; margin-right:15px; }
        .bus-info { flex:1; }
        .bus-info h3 { font-size:16px; margin-bottom:5px; color:#2c3e50; }
        .bus-info p { font-size:12px; color:#7f8c8d; }
        .bus-status { padding:5px 10px; border-radius:20px; font-size:12px; font-weight:bold; }
        .status-on-time { background:#e8f5e9; color:#2e7d32; }
        .status-delayed { background:#ffebee; color:#c62828; }
        .status-arriving { background:#fff8e1; color:#f9a825; }
        .map-container { flex:1; position:relative; }
        #map { height:100%; width:100%; }
        .map-controls { position:absolute; top:15px; right:15px; z-index:1000; display:flex; flex-direction:column; gap:10px; }
        .control-btn { width:40px; height:40px; border-radius:50%; background:white; border:none; box-shadow:0 2px 5px rgba(0,0,0,0.2); display:flex; align-items:center; justify-content:center; cursor:pointer; color:#2c3e50; font-size:18px; }
        .control-btn:hover { background:#f8f9fa; }
        .gps-status { position:absolute; bottom:15px; left:15px; z-index:1000; background:white; padding:8px 12px; border-radius:4px; box-shadow:0 2px 5px rgba(0,0,0,0.2); display:flex; align-items:center; gap:8px; font-size:14px; }
        .gps-indicator { width:12px; height:12px; border-radius:50%; }
        .gps-active { background:#4caf50; }
        .gps-inactive { background:#f44336; }
        .gps-searching { background:#ff9800; }
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; align-items:center; justify-content:center; }
        .modal-content { background:white; border-radius:8px; width:400px; max-width:90%; box-shadow:0 4px 15px rgba(0,0,0,0.2); overflow:hidden; }
        .modal-header { padding:15px 20px; background:#2c3e50; color:white; display:flex; justify-content:space-between; align-items:center; }
        .close-modal { background:none; border:none; color:white; font-size:20px; cursor:pointer; }
        .modal-body { padding:20px; }
        .bus-options { display:flex; flex-direction:column; gap:10px; margin:15px 0; }
        .bus-option { padding:12px; border:1px solid #ddd; border-radius:4px; cursor:pointer; transition: background-color 0.2s; }
        .bus-option:hover { background:#f5f5f5; }
        .bus-option.selected { border-color:#3498db; background:#e3f2fd; }
        .modal-footer { padding:15px 20px; background:#f8f9fa; display:flex; justify-content:flex-end; gap:10px; }
        .modal-btn { padding:8px 16px; border:none; border-radius:4px; cursor:pointer; font-weight:bold; }
        .btn-cancel { background:#f8f9fa; color:#6c757d; }
        .btn-confirm { background:#3498db; color:white; }
        .toast { position:fixed; bottom:20px; right:20px; padding:12px 20px; background:#323232; color:white; border-radius:4px; box-shadow:0 2px 5px rgba(0,0,0,0.2); display:flex; align-items:center; gap:10px; z-index:3000; opacity:0; transform:translateY(20px); transition:opacity 0.3s, transform 0.3s; }
        .toast.show { opacity:1; transform:translateY(0); }
        .debug-panel { position:absolute; top:15px; left:15px; z-index:1000; background:rgba(255,255,255,0.9); padding:10px; border-radius:4px; box-shadow:0 2px 5px rgba(0,0,0,0.2); font-size:12px; max-width:300px; display:none; }
        .debug-toggle { position:absolute; top:70px; left:15px; z-index:1000; background:white; border:none; border-radius:4px; padding:5px 10px; font-size:12px; box-shadow:0 2px 5px rgba(0,0,0,0.2); cursor:pointer; }
        .form-group { margin-bottom:15px; }
        .form-group label { display:block; margin-bottom:5px; font-weight:bold; }
        .form-group input { width:100%; padding:10px; border:1px solid #ddd; border-radius:4px; }
        .action-buttons { display:flex; gap:10px; margin-top:20px; }
        .action-btn { flex:1; padding:12px; border:none; border-radius:4px; cursor:pointer; font-weight:bold; }
        .btn-connect { background:#3498db; color:white; }
        .btn-view { background:#2ecc71; color:white; }
        @media (max-width:768px) {
            .container { flex-direction:column; }
            .sidebar { width:100%; height:40%; }
            .header-info { display:none; }
        }
    </style>
</head>
<body>
    <!-- ============ HEADER ============ -->
    <header>
        <div class="logo"><i class="fas fa-bus"></i><h1>Bus Tracker GPS</h1></div>
        <div class="header-info">
            <div>Last Update: <span id="last-update">--:--:--</span></div>
            <div>Active Buses: <span id="active-buses">0</span></div>
        </div>
    </header>
    
    <!-- ============ CONTAINER ============ -->
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="search-box">
                    <input type="text" placeholder="Search for a bus...">
                    <button><i class="fas fa-search"></i></button>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="total-buses">0</div>
                        <div class="stat-label">Total Buses</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="on-time">0</div>
                        <div class="stat-label">On Time</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="delayed">0</div>
                        <div class="stat-label">Delayed</div>
                    </div>
                </div>
            </div>
            <div class="bus-list" id="bus-list">
                <!-- Bus items populated dynamically -->
            </div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="map-controls">
                <button class="control-btn" id="zoom-in" title="Zoom In"><i class="fas fa-plus"></i></button>
                <button class="control-btn" id="zoom-out" title="Zoom Out"><i class="fas fa-minus"></i></button>
                <button class="control-btn" id="locate-me" title="Locate Me"><i class="fas fa-crosshairs"></i></button>
                <button class="control-btn" id="bus-select-btn" title="Select Bus"><i class="fas fa-bus"></i></button>
                <button class="control-btn" id="stop-tracking" title="Stop Tracking" style="display:none;"><i class="fas fa-stop"></i></button>
            </div>
            <div class="gps-status" id="gps-status">
                <div class="gps-indicator gps-inactive" id="gps-indicator"></div>
                <span id="gps-text">GPS Inactive</span>
            </div>
            <button class="debug-toggle" id="debug-toggle">Debug</button>
            <div class="debug-panel" id="debug-panel">
                <h3>Debug Information</h3>
                <div id="debug-content">No data yet</div>
            </div>
        </div>
    </div>
    
    <!-- ============ MODALS ============ -->
    <!-- Bus Selection Modal -->
    <div class="modal" id="bus-modal">
        <div class="modal-content">
            <div class="modal-header"><h2>Select Your Bus</h2><button class="close-modal">&times;</button></div>
            <div class="modal-body">
                <p>Choose the bus you're currently driving:</p>
                <div class="bus-options">
                    <div class="bus-option" data-bus-id="1"><strong>Campus Shuttle A</strong> (ID: 1)</div>
                    <div class="bus-option" data-bus-id="2"><strong>North Route</strong> (ID: 2)</div>
                    <div class="bus-option" data-bus-id="3"><strong>South Route</strong> (ID: 3)</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" id="cancel-select">Cancel</button>
                <button class="modal-btn btn-confirm" id="confirm-select">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Action Modal -->
    <div class="modal" id="action-modal">
        <div class="modal-content">
            <div class="modal-header"><h2 id="action-modal-title">Bus Options</h2><button class="close-modal">&times;</button></div>
            <div class="modal-body">
                <p>What would you like to do with this bus?</p>
                <div class="action-buttons">
                    <button class="action-btn btn-connect" id="connect-action">Connect Location</button>
                    <button class="action-btn btn-view" id="view-action">Show Location</button>
                </div>
            </div>
            <div class="modal-footer"><button class="modal-btn btn-cancel" id="cancel-action">Cancel</button></div>
        </div>
    </div>

    <!-- Driver Login Modal -->
    <div class="modal" id="driver-login-modal">
        <div class="modal-content">
            <div class="modal-header"><h2>Driver Login</h2><button class="close-modal">&times;</button></div>
            <div class="modal-body">
                <div class="form-group"><label for="driver-id">Driver ID</label><input type="text" id="driver-id" placeholder="Enter your driver ID"></div>
                <div class="form-group"><label for="driver-password">Password</label><input type="password" id="driver-password" placeholder="Enter your password"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" id="cancel-driver-login">Cancel</button>
                <button class="modal-btn btn-confirm" id="confirm-driver-login">Login</button>
            </div>
        </div>
    </div>

    <!-- Student/Staff Login Modal -->
    <div class="modal" id="user-login-modal">
        <div class="modal-content">
            <div class="modal-header"><h2>Student/Staff Login</h2><button class="close-modal">&times;</button></div>
            <div class="modal-body">
                <div class="form-group"><label for="user-id">ID Number</label><input type="text" id="user-id" placeholder="Enter your ID number"></div>
                <div class="form-group"><label for="user-password">Password</label><input type="password" id="user-password" placeholder="Enter your password"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" id="cancel-user-login">Cancel</button>
                <button class="modal-btn btn-confirm" id="confirm-user-login">Login</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toast-message"></span>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="./app.js"></script>
</body>
</html>
